# 3. 리덕스의 세가지 규칙

리덕스를 프로젝트에서 사용할 때 지켜야 하는 세 가지 규칙을 알아보자.

1. 단일 스토어
2. 읽기 전용 상태
3. 리듀서는 순수 함수

## 1. 단일 스토어

하나의 애플리케이션 안에는 하나의 스토어. 사실 스토어를 여러 개 사용할 수도 있지만 상태 관리가 복잡해질 수 있으므로 권장하지 않는다.

## 2. 읽기 전용 상태

리덕스의 state는 읽기 전용(read-only)이다. 기존에 setState를 사용해서 state를 업데이트할 때 불변성을 유지했던 것처럼 리덕스의 상태도 수정하지 않고 새로 만들어 재할당해야 한다.

리덕스에서 불변성을 유지해야 하는 이유는 내부적으로 데이터가 변경되는 것을 감지하기 위해 얕은 비교(shallow equailty) 검사를 하기 때문이다. 즉, **객체나 배열같은 reference type인 경우 주소 값이 변경되어야 변화를 감지**할 수 있다.

## 3. 리듀서는 순수 함수로

액션이 발생되면 변화를 일으키는 리듀서 함수는 순수 함수(Pure function)여야 한다. 순수 함수는 다음 조건을 만족한다.

- 리듀서 함수는 이전 상태와 액션 객체를 파라미터로 받음
- **파라미터 값 외에는 의존하면 안 됨**
- 이전 상태를 **절대 건드리지 않고** 변화를 준 새로운 상태 객체를 만들어 반환
- 똑같은 파라미터로 호출된 리듀서 함수는 **언제나 같은 결과 값을 반환**

Pure Function은 외부 상태를 변화시키지 않으며 같은 입력에 대해서 언제나 같은 값을 리턴하는 함수를 말한다.

리듀서 함수 내에서 랜덤 값을 만들거나, Date 함수를 이용해 변화하는 시간을 가져오거나, 네트워크 요청을 한다면 파라미터가 같아도 다른 결과를 만들어낼 수 있기 때문에 사용하면 안 된다. 이런 작업은 리듀서 함수 바깥에서 처리해야 한다. (액션을 만드는 과정, 리덕스 미들웨어 등)

주로 **네트워크 요청과 같은 비동기 작업은 미들웨어를 통해 관리**한다.

리액트에서 리덕스를 사용하는 방법 또한 바닐라에서와 비슷하다.

1. 액션 타입과 액션 생성 함수를 작성
2. 리듀서 작성
3. 스토어 생성(reducer전달)
4. 스토어의 내장함수로 액션을 발생(dispatch)시키고 리스너를 구독(subscribe)

